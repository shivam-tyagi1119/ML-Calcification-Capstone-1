# -----------------------------------------------------------------------------
# Base image (TensorFlow-compatible & audit-safe)
# -----------------------------------------------------------------------------
FROM python:3.10-slim

# -----------------------------------------------------------------------------
# Environment hardening
# -----------------------------------------------------------------------------
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /app

# -----------------------------------------------------------------------------
# Install dependencies
# -----------------------------------------------------------------------------
COPY requirements.txt .

RUN pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# -----------------------------------------------------------------------------
# Copy application artifacts
# -----------------------------------------------------------------------------
COPY predict.py .
COPY best_model_lr_0.01_dropout_0.3.keras .

# -----------------------------------------------------------------------------
# Expose API port
# -----------------------------------------------------------------------------
EXPOSE 9696

# -----------------------------------------------------------------------------
# Start inference service
# -----------------------------------------------------------------------------
ENTRYPOINT ["gunicorn", "--bind=0.0.0.0:9696", "predict:app"]
